# База с корректным GPU-рантаймом и libcuda:
FROM nvidia/cuda:12.8.0-runtime-ubuntu22.04

# Минимум утилит + Python
RUN apt-get update && apt-get install -y python3 python3-pip git curl && rm -rf /var/lib/apt/lists/*

# vLLM с поддержкой CUDA 12.8 (совместимо с твоим драйвером 581.42 / CUDA 13)
RUN pip3 install --no-cache-dir "vllm==0.11.0"

ENV NVIDIA_VISIBLE_DEVICES=all \
    NVIDIA_DRIVER_CAPABILITIES=compute,utility \
    LD_LIBRARY_PATH=/usr/local/nvidia/lib64:/usr/local/nvidia/lib:/usr/lib/x86_64-linux-gnu

WORKDIR /workspace
ENTRYPOINT ["python3","-m","vllm.entrypoints.openai.api_server"]
